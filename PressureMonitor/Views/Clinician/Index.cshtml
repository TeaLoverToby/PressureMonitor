@model Clinician

@{
    var patients = Model.Patients as List<PressureMonitor.Models.Patient>;
    ViewData["Title"] = "Clinician Dashboard";
}

<style>
    .main-content-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    .patient-list-section, .patient-info-section, .clinician-comment-section {
        border: 2px solid #333;
        padding: 10px;
        position: relative;
        min-height: 350px;
        max-width: 600px;
    }

    .user-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .user-title {
        font-weight: bold;
    }

    .user-grid {

        display: grid;
        grid-template-columns: repeat(1, 1fr);
        gap: 10px 20px;
    }

    .user-item {
        font-size: 0.9rem;
    }

        .user-item span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

    .help-icon {
        width: 16px;
        height: 16px;
        border: 1px solid #333;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7rem;
        cursor: help;
    }

    .view-details-btn {
        padding: 8px 30px;
        background: #cca808;
        border: 2px solid #333;
        font-weight: bold;
        cursor: pointer;
    }

        .view-details-btn:hover {
            background: #e7e07b;
        }

</style>

@using (Html.BeginForm("UserSelected", "Clinician", FormMethod.Post, new { id = "UserForm" }))
{
    <div class="text-center">
        <div class="container-fluid">
            <div class="dashboard-header">
                <div class="dashboard-title-section">
                    <div>
                        <h1>Clinician Dashboard</h1>
                        <p>Welcome back, @Model.User.Username!</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="main-content-layout">
            @Html.HiddenFor(m => m.Id)
            <div class="patient-list-section">
                <div class="user-header">
                    <div class="user-title">Patient Selection</div>
                </div>
                <div class="user-grid">
                    <div class="user-listbox">
                        @Html.DropDownListFor(m => m.SelectedUserItem.Value, Model.GetUserItems, new { size = 20, style = "width:100%;", onchange = "document.getElementById('UserForm').submit();" })
                    </div>
                </div>
            </div>

            <div class="patient-info-section">
                <div class="user-header">
                    <div class="user-title">Selected Patient Data</div>
                </div>
                    <div class="user-grid">
                    @if (patients == null || !patients.Any())
                    {
                        <div class="alert alert-warning">No patients found.</div>
                    }
                    else
                    {
                        <div class="list-group">
                            @foreach (var patient in patients)
                            {
                                <div class="list-group-item">
                                    <h5 class="mb-1">@patient.User.Username (ID: @patient.Id)</h5>
                                    @if (patient.PressureMaps.Any())
                                    {
                                        <div class="d-flex flex-wrap gap-2 mt-2">
                                            @foreach (var map in patient.PressureMaps.OrderByDescending(pm => pm.Day).DistinctBy(pm => pm.Day))
                                            {
                                                <a asp-action="ViewPatientPressureMap" asp-route-patientId="@patient.Id" asp-route-day="@map.Day.ToString("yyyy-MM-dd")"
                                                   class="btn btn-outline-primary btn-sm">
                                                    View @map.Day.ToString("MM/dd/yyyy")
                                                </a>
                                            }
                                        </div>
                                    }
                                    else
                                    {
                                        <p class="text-muted mb-0">No pressure maps available.</p>
                                    }
                                </div>
                            }
                        </div>
                    }
                    </div>
            </div>


            <div class="clinician-comment-section">
                <div class="user-header">
                    <div class="user-title">Comments</div>
                </div>
                <div class="user-grid">
                    @*
                        clinician comments to be added here (WILLOW THIS IS YOUR BIT)
                    *@
                </div>
            </div>
        </div>
</div>
}